name: Claude Code
on:
    issue_comment:
        types: [created]
    pull_request_review_comment:
        types: [created]
    pull_request:
        types: [opened, synchronize]

permissions:
    pull-requests: write
    contents: read
    issues: write

jobs:
    review:
        runs-on: ubuntu-latest
        # Only run on @claude mentions for comments, always run for PR events
        if: |
            github.event_name == 'pull_request' ||
            (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
            (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude'))
        steps:
            - uses: anthropics/claude-code-action@v1
              with:
                  claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
                  prompt: "/review"
                  claude_args: "--max-turns 5"
