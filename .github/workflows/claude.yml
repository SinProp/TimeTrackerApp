name: Claude Code
on:
    issue_comment:
        types: [created]
    pull_request_review_comment:
        types: [created]
    pull_request:
        types: [opened, synchronize]

permissions:
    pull-requests: write
    contents: read
    issues: write
    id-token: write

jobs:
    review:
        runs-on: ubuntu-latest
        if: |
            github.event_name == 'pull_request' ||
            contains(github.event.comment.body, '@claude') ||
            contains(github.event.comment.body, '/review')
        steps:
            - uses: anthropics/claude-code-action@v1
              with:
                  claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
                  prompt: "/review"
                  claude_args: "--max-turns 5"
